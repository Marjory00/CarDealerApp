<!-- car_detail.html -->

{% extends "base.html" %}

{% block title %}
    Car Detail: {{ car.year }} {{ car.make }} {{ car.model }}
{% endblock %}

{% block content %}
    <div class="form-container">
        <h2>{{ car.year }} {{ car.make }} {{ car.model }}</h2>
        <p class="text-muted">VIN: **{{ car.vin }}**</p>
        <hr>

        {# 
        FIX: The logic here is complex but keeps the assumption that 'car.image_url' 
        is a filename inside the static/images folder.
        If car.image_url is a full web URL (e.g., http://...), you would use it directly:
        {% set image_src = car.image_url if car.image_url else url_for('static', filename='images/placeholder.png') %}
        
        Using your current logic:
        #}
        {% set image_path = 'images/' + car.image_url if car.image_url and car.image_url.strip() else 'images/placeholder.png' %}
        
        <img src="{{ url_for('static', filename=image_path) }}"
              alt="{{ car.make }} {{ car.model }} Photo"
              data-fallback-src="{{ url_for('static', filename='images/placeholder.png') }}"
              onerror="this.onerror=null; this.src=this.getAttribute('data-fallback-src');" ¬† 
              style="max-width: 100%; height: auto; border-radius: 5px; margin-bottom: 20px;">


        <div class="specs-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <p><strong>Year:</strong> {{ car.year }}</p>
            <p><strong>Price:</strong> <span class="price">${{ "{:,.2f}".format(car.price) }}</span></p>
            <p><strong>Make:</strong> {{ car.make }}</p>
            <p><strong>Model:</strong> {{ car.model }}</p>
            <p style="grid-column: 1 / span 2;"><strong>VIN:</strong> {{ car.vin }}</p>
        </div>

        {# Removed raw Image URL display as it's primarily a backend detail #}
        
        <div class="action-buttons" style="margin-top: 30px; display: flex; gap: 10px;">
            
            {# FIX: Changed endpoint from 'edit_car_web' to 'edit_car' #}
            <a href="{{ url_for('edit_car', vin=car.vin) }}" class="btn btn-secondary">üìù Edit Details</a>

            {# FIX: Changed endpoint from 'sell_car_web' to 'sell_car' #}
            <form method="POST"
                  action="{{ url_for('sell_car', vin=car.vin) }}"
                  onsubmit="return confirm('Are you sure you want to sell {{ car.make }} {{ car.model }}? This action is permanent and will remove it from inventory.');"
                  style="margin: 0;">
                <button type="submit" class="btn btn-danger">üí∞ Sell Car</button>
            </form>
        </div>

        <a href="{{ url_for('index') }}" style="display: block; margin-top: 20px;">‚Üê Back to Inventory</a>
    </div>
{% endblock %}