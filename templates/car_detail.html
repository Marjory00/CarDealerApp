<!-- car_detail.html -->

{% extends "base.html" %}

{% block title %}
    Car Detail: {{ car.make }} {{ car.model }}
{% endblock %}

{% block content %}
    <div class="form-container">
        <h2>{{ car.year }} {{ car.make }} {{ car.model }} ({{ car.vin }})</h2>
        <hr>

        {# Set the primary image path, falling back to placeholder if image_url is empty/None #}
        {% set image_path = 'images/' + car.image_url if car.image_url and car.image_url.strip() else 'images/placeholder.png' %}
        
        <img src="{{ url_for('static', filename=image_path) }}"
             alt="{{ car.make }} {{ car.model }} Photo"
             data-fallback-src="{{ url_for('static', filename='images/placeholder.png') }}"
             onerror="this.onerror=null; this.src=this.getAttribute('data-fallback-src');"   
             style="max-width: 100%; height: auto; border-radius: 5px; margin-bottom: 20px;">


        <p><strong>VIN:</strong> {{ car.vin }}</p>
        <p><strong>Price:</strong> <span class="price">${{ "{:,.2f}".format(car.price) }}</span></p>
        <p><strong>Year:</strong> {{ car.year }}</p>
        
        <p><strong>Image URL:</strong> {{ car.image_url }}</p>

        <div class="action-buttons" style="margin-top: 30px; display: flex; gap: 10px;">
            <a href="{{ url_for('edit_car_web', vin=car.vin) }}" class="btn btn-secondary">📝 Edit Details</a>

            <form method="POST"
                  action="{{ url_for('sell_car_web', vin=car.vin) }}"
                  onsubmit="return confirm('Are you sure you want to sell {{ car.make }} {{ car.model }}? This action is permanent and will remove it from inventory.');"
                  style="margin: 0;">
                <button type="submit" class="btn btn-danger">💰 Sell Car</button>
            </form>
        </div>

        <a href="{{ url_for('index') }}" style="display: block; margin-top: 20px;">← Back to Inventory</a>
    </div>
{% endblock %}