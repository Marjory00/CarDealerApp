
<!-- edit_car.html -->


{% extends "base.html" %}

{% block title %}Edit {{ car.make }} {{ car.model }}{% endblock %} 

{% block content %}
    <div class="form-container">
        <h2>üìù Edit {{ car.year }} {{ car.make }} {{ car.model }}</h2>
        <p>You can update the **Year**, **Price**, and **Image URL** for VIN **{{ car.vin }}**.</p>
        <hr>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}" role="alert" style="margin-bottom: 20px;">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <form method="POST" action="{{ url_for('edit_car', vin=car.vin) }}" class="car-form">
            
            <div class="form-group">
                <label for="vin">VIN (Cannot be changed):</label>
                <input type="text" id="vin" name="vin_display" value="{{ car.vin }}" disabled>
            </div>
            <div class="form-group">
                <label for="make">Make (Cannot be changed):</label>
                <input type="text" id="make" name="make_display" value="{{ car.make }}" disabled>
            </div>
            <div class="form-group">
                <label for="model">Model (Cannot be changed):</label>
                <input type="text" id="model" name="model_display" value="{{ car.model }}" disabled>
            </div>

            <div class="form-group">
                <label for="year">New Year:</label>
                <input type="number" id="year" name="year" 
                       {# FIX 3: Prioritize 'form_data' (if POST failed) over 'car' data #}
                       value="{{ form_data.year if form_data else car.year }}" 
                       required min="1900" max="{{ max_year }}">
                <small class="form-text">Must be a valid year (1900 - {{ max_year }}).</small>
            </div>

            <div class="form-group">
                <label for="price">New Price ($):</label>
                <input type="number" id="price" name="price" 
                       {# FIX 3: Prioritize 'form_data' (if POST failed) over 'car' data #}
                       value="{{ form_data.price if form_data else '{:.2f}'.format(car.price) }}" 
                       required step="0.01" min="0">
            </div>
            
            <div class="form-group">
                <label for="image_url">New Image URL (Optional):</label>
                <input type="url" id="image_url" name="image_url" 
                       {# FIX 3: Prioritize 'form_data' (if POST failed) over 'car' data #}
                       value="{{ form_data.image_url if form_data else car.image_url or '' }}">
                <small class="form-text">Enter a full web address (http://...)</small>
            </div>

            <div class="form-actions" style="margin-top: 20px; display: flex; gap: 10px;">
                <button type="submit" class="btn btn-primary">Save Changes</button>
                <a href="{{ url_for('car_detail', vin=car.vin) }}" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
        
        <a href="{{ url_for('index') }}" style="display: block; margin-top: 15px;">‚Üê Back to Inventory List</a>
    </div>
{% endblock %}